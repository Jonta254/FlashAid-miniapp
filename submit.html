<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FlashAid - Submit Transfer</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #0a1f44;
      color: #fff;
      margin: 0; padding: 20px;
      display: flex; flex-direction: column; align-items: center;
      min-height: 100vh;
    }
    h2 {
      color: #ffae00;
      margin-bottom: 10px;
    }
    form {
      background: #112a66;
      padding: 20px;
      border-radius: 12px;
      max-width: 400px;
      width: 100%;
      box-sizing: border-box;
      box-shadow: 0 0 15px #ffae0050;
    }
    label {
      display: block;
      margin: 15px 0 6px;
      font-weight: bold;
    }
    select, input[type="text"], input[type="number"], input[type="file"] {
      width: 100%;
      padding: 10px;
      border-radius: 8px;
      border: none;
      font-size: 1rem;
      box-sizing: border-box;
    }
    input[type="checkbox"] {
      margin-right: 10px;
      transform: scale(1.3);
      vertical-align: middle;
      cursor: pointer;
    }
    .fee-info {
      margin-top: 6px;
      font-size: 0.9rem;
      color: #ffd966;
    }
    .okx-extra {
      margin-top: 10px;
      background: #16336b;
      padding: 12px;
      border-radius: 8px;
      display: none;
    }
    button {
      background: #ffae00;
      border: none;
      color: #0a1f44;
      font-weight: bold;
      font-size: 1.1rem;
      padding: 15px;
      margin-top: 25px;
      border-radius: 8px;
      width: 100%;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    button:disabled {
      background: #a18200aa;
      cursor: not-allowed;
    }
    button:hover:not(:disabled) {
      background: #ffa600cc;
    }
    #screenshotPreview {
      margin-top: 10px;
      max-width: 100%;
      border-radius: 8px;
      box-shadow: 0 0 10px #ffae0050;
    }
    .message {
      margin-top: 15px;
      font-weight: bold;
      text-align: center;
    }
    .error {
      color: #ff6f6f;
    }
    .success {
      color: #6fff89;
    }
  </style>
</head>
<body>

  <h2>Submit Transfer</h2>

  <form id="transferForm" enctype="multipart/form-data" novalidate>
    <label for="assetSelect">Select Asset</label>
    <select id="assetSelect" required>
      <option value="" disabled selected>Select asset</option>
      <option value="WLD">WLD</option>
      <option value="USDC">USDC</option>
    </select>

    <label for="amountInput">Amount</label>
    <input type="number" id="amountInput" min="1" step="any" placeholder="Enter amount" required />

    <div class="fee-info" id="feeInfo"></div>

    <label for="payoutSelect">Choose Payout Method</label>
    <select id="payoutSelect" required>
      <option value="" disabled selected>Select payout</option>
      <option value="mpesa">M-Pesa</option>
      <option value="safaricom_airtime">Safaricom Airtime</option>
      <option value="airtel_money">Airtel Money</option>
      <option value="okx">OKX (Crypto Withdrawal)</option>
    </select>

    <div class="okx-extra" id="okxExtraFields">
      <label for="okxUsdcAmount">USDC Amount</label>
      <input type="number" id="okxUsdcAmount" min="1" step="any" placeholder="Enter USDC amount" />

      <label for="okxNetwork">Network</label>
      <input type="text" id="okxNetwork" value="Optimism" readonly />

      <label for="okxWallet">Wallet Address</label>
      <input type="text" id="okxWallet" value="0xYourOkxWalletAddressHere" readonly />
    </div>

    <label for="phoneInput">Phone Number</label>
    <input type="text" id="phoneInput" placeholder="Enter phone number" pattern="^\+?\d{9,15}$" required />

    <label for="screenshotInput">Upload Screenshot (optional)</label>
    <input type="file" id="screenshotInput" accept="image/*" />

    <img id="screenshotPreview" alt="Screenshot Preview" style="display:none;" />

    <label>
      <input type="checkbox" id="confirmCheckbox" required />
      I confirm the transfer was done outside FlashAid
    </label>

    <button type="submit" id="submitBtn" disabled>Submit Request</button>
  </form>

  <div class="message" id="formMessage"></div>

<script>
  const feePercent = 2; // Fee percentage (2%)
  const amountInput = document.getElementById('amountInput');
  const feeInfo = document.getElementById('feeInfo');
  const payoutSelect = document.getElementById('payoutSelect');
  const okxExtraFields = document.getElementById('okxExtraFields');
  const okxUsdcAmount = document.getElementById('okxUsdcAmount');
  const phoneInput = document.getElementById('phoneInput');
  const screenshotInput = document.getElementById('screenshotInput');
  const screenshotPreview = document.getElementById('screenshotPreview');
  const confirmCheckbox = document.getElementById('confirmCheckbox');
  const submitBtn = document.getElementById('submitBtn');
  const formMessage = document.getElementById('formMessage');
  const assetSelect = document.getElementById('assetSelect');

  // Show/hide OKX fields based on payout method
  payoutSelect.addEventListener('change', () => {
    if (payoutSelect.value === 'okx') {
      okxExtraFields.style.display = 'block';
      okxUsdcAmount.required = true;
    } else {
      okxExtraFields.style.display = 'none';
      okxUsdcAmount.required = false;
      okxUsdcAmount.value = '';
    }
    validateForm();
  });

  // Fee calculation and display live
  function updateFeeInfo() {
    const val = parseFloat(amountInput.value);
    if (isNaN(val) || val <= 0) {
      feeInfo.textContent = '';
      return;
    }
    const feeAmount = (val * feePercent) / 100;
    const amountAfterFee = val - feeAmount;
    feeInfo.textContent = `Fee (${feePercent}%): ${feeAmount.toFixed(4)} | Amount after fee: ${amountAfterFee.toFixed(4)}`;
  }

  amountInput.addEventListener('input', () => {
    updateFeeInfo();
    validateForm();
  });

  // Screenshot preview
  screenshotInput.addEventListener('change', () => {
    const file = screenshotInput.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        screenshotPreview.src = e.target.result;
        screenshotPreview.style.display = 'block';
      };
      reader.readAsDataURL(file);
    } else {
      screenshotPreview.style.display = 'none';
      screenshotPreview.src = '';
    }
  });

  // Simple phone validation (you can improve regex)
  function isValidPhone(phone) {
    return /^\+?\d{9,15}$/.test(phone);
  }

  // Validate form fields
  function validateForm() {
    const assetValid = assetSelect.value !== '';
    const amountVal = parseFloat(amountInput.value);
    const amountValid = !isNaN(amountVal) && amountVal > 0;
    const payoutValid = payoutSelect.value !== '';
    const phoneValid = isValidPhone(phoneInput.value);
    const confirmChecked = confirmCheckbox.checked;

    let okxValid = true;
    if (payoutSelect.value === 'okx') {
      const usdcVal = parseFloat(okxUsdcAmount.value);
      okxValid = !isNaN(usdcVal) && usdcVal > 0;
    }

    const valid = assetValid && amountValid && payoutValid && phoneValid && confirmChecked && okxValid;
    submitBtn.disabled = !valid;
    return valid;
  }

  // Re-validate on input changes
  payoutSelect.addEventListener('change', validateForm);
  phoneInput.addEventListener('input', validateForm);
  confirmCheckbox.addEventListener('change', validateForm);
  assetSelect.addEventListener('change', validateForm);
  okxUsdcAmount.addEventListener('input', validateForm);

  // Handle form submit
  document.getElementById('transferForm').addEventListener('submit', (e) => {
    e.preventDefault();
    formMessage.textContent = '';
    if (!validateForm()) {
      formMessage.textContent = 'Please fill all required fields correctly.';
      formMessage.className = 'message error';
      return;
    }

    submitBtn.disabled = true;
    submitBtn.textContent = 'Submitting...';

    // Here you would send form data to your backend or smart contract
    // For now, simulate success after 1.5 seconds

    setTimeout(() => {
      formMessage.textContent = 'âœ… Transfer request submitted successfully!';
      formMessage.className = 'message success';
      submitBtn.textContent = 'Submit Request';
      submitBtn.disabled = false;
      document.getElementById('transferForm').reset();
      screenshotPreview.style.display = 'none';
      okxExtraFields.style.display = 'none';
      feeInfo.textContent = '';
    }, 1500);
  });

  // Initial focus
  assetSelect.focus();
</script>

</body>
</html>
